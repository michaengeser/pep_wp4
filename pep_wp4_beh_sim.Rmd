---
title: "PEP_wp4_beh"
output: html_document
date: "2023-12-15"
---

# housekeeping

```{r huosekeeping}
# clear workspace
rm(list = ls())

wd = 'C:/Users/JLU-SU/OneDrive - Justus-Liebig-UniversitÃ¤t GieÃŸen/Dokumente/GitHub/pep_wp4_analysis'
setwd(wd)
dir()

# get package manager package
if (!('pacman' %in% installed.packages()))
{install.packages("pacman")}
library(pacman)

# install all needed packages 

pacman::p_load('dplyr', 'ggdist', 'ggeffects', 'ggpubr', 'lme4', 'emmeans', 'rstatix', 'car', 'rsq', 'sjPlot', 'brms')

library(pairs)

```


# loading files

```{r loading}
# details of subjects  
subNums = c(101) # ,102,103, 106,107,108)
n = length(subNums)
sessions = c(1,2)
tasks = c('categorization', 'typicality', 'familiarity', 'aesthetic', 'usability', 'complexity')
categories = c('bathroom', 'kitchen')

# prepare loading
count = 0
sub_ids = NaN
table_size = 1:18

# loading the files 

for (subNum in subNums ){
  for (task in tasks ){
    for (category in categories ){    
      count = count + 1
      
      # make session number
      if (task == 'categorization'){ ses = 1 }
      else { ses = 2 }
      
      sub_folder = paste0('sub-', subNum)
      ses_folder = paste0('ses-', ses)
      
      # make file name
      if (task == 'categorization'){
        file_name = paste0(sub_folder, '_', ses_folder, '_run-all_task-', task,'_events.csv')
      } else {
        file_name = paste0(sub_folder, '_', ses_folder, '_run-all_task-', task , '_' ,category, '_events.csv')
      }
      
      # make path
      setwd("..")
      parent_dir = getwd()
      setwd(wd)
      
      if (task == 'categorization'){
        file_name = file.path(parent_dir, 'pep_wp4', 'data', sub_folder, ses_folder, task, file_name)
      } else {
        file_name = file.path(parent_dir, 'pep_wp4', 'data', sub_folder, ses_folder, task, category, file_name)
      }
      
      if (file.exists(file_name)) {
        # load file
        event_table = read.csv(file_name)}
      
      # concatenate the tables
      if ( exists('all_event_table')){
        all_event_table = rbind(all_event_table, event_table)
      } else {
        all_event_table = event_table
      }
    }}}

```

# apply trial exclusion

```{r trial_exclusion}

# come up with trial removal

```

# transfrom data

``` {r transform_data}

# does data need any other transforamtion

# make task tables
cate_table = all_event_table %>% filter(is_practice == 0 & task == 'categorization')
typ_table = all_event_table %>% filter(is_practice == 0 & task == 'typicality')
fam_table = all_event_table %>% filter(is_practice == 0 & task == 'familiarity')
aes_table = all_event_table %>% filter(is_practice == 0 & task == 'aesthetic')
use_table = all_event_table %>% filter(is_practice == 0 & task == 'usability')
com_table = all_event_table %>% filter(is_practice == 0 & task == 'complexity')

# split by category
cate_table_bath = cate_table %>% filter(category == 'bathroom')
cate_table_kit = cate_table %>% filter(category == 'kitchen')

# image identity table
img_id_table = cate_table %>%  group_by(sub_num, image, category) %>%
  summarise(mean_RT = mean(RT, na.rm = TRUE),
            sd_RT = sd(RT, na.rm = TRUE),
            mean_acc = mean(trial_accuracy, na.rm = TRUE),
            sd_acc = sd(trial_accuracy, na.rm = TRUE))

# sort based on image name 
img_id_table = img_id_table %>% arrange(sub_num, category, image)

# add ratings
img_id_table$typicality = typ_table %>% arrange(sub_num, category, image) %>% pull(trial_response)
img_id_table$familiarity = fam_table %>% arrange(sub_num, category, image) %>% pull(trial_response)
img_id_table$aesthetic = aes_table %>% arrange(sub_num, category, image) %>% pull(trial_response)
img_id_table$usability = use_table %>% arrange(sub_num, category, image) %>% pull(trial_response)
img_id_table$complexity = com_table %>% arrange(sub_num, category, image) %>% pull(trial_response)

# image identity table
just_img_id_table = img_id_table %>%  group_by(image, category) %>%
  summarise(mean_RT = mean(RT, na.rm = TRUE),
            sd_RT = sd(RT, na.rm = TRUE),
            mean_acc = mean(trial_accuracy, na.rm = TRUE),
            sd_acc = sd(trial_accuracy, na.rm = TRUE))

##### CHECK If RATING ARE CORRECT #### ALSO CHECK IF RT AND ACC MAKE SENSE (compare with matlab script)


```

# simulate new data

```{r simulate new data}

# set parameters
sim_subs = 10
RT_sd = 1
acc_sd = 1
rating_sd = 1
baseline_sd = 1


for (subNum in subNums ){
  
  # get distributions
  baseline_dis = rnorm(sim_subs, 0, baseline_sd)
  RT_dis = rnorm(sim_subs,mean(all_event_table %>% filter(sub_num == subNum & task == 'categorization') %>% pull(RT)), RT_sd)
  acc_dis = rnorm(sim_subs,mean(all_event_table %>% filter(sub_num == subNum & task == 'categorization') %>% pull(trial_accuracy)), acc_sd)
  typ_dis = rnorm(sim_subs,mean(all_event_table %>% filter(sub_num == subNum & task == 'typicality') %>% pull(trial_response)), rating_sd)
  
  for (sim_sub in 1:sim_subs ){  
    count = count + 1
    
    # get table for one subject 
    sub_table = all_event_table %>% filter(sub_num == subNum)
    
    
    
  }}

```


